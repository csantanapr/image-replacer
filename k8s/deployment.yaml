apiVersion: v1
kind: Service
metadata:
  name: klustered
  annotations:
    service.beta.openshift.io/serving-cert-secret-name: klustered
  labels:
    app: klustered
spec:
  ports:
    - name: https
      port: 443
      targetPort: https
  selector:
    app: klustered
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: klustered
  annotations:
    app.openshift.io/vcs-ref: main
    app.openshift.io/vcs-uri: https://github.com/csantanapr/klustered
  labels:
    app: klustered
    version: v1
    app.kubernetes.io/component: klustered
    app.kubernetes.io/instance: klustered
    app.kubernetes.io/name: klustered
    app.kubernetes.io/part-of: klustered
    app.openshift.io/runtime: nodejs
    app.openshift.io/runtime-version: "14"
spec:
  selector:
    matchLabels:
      app: klustered
      version: v1
  template:
    metadata:
      labels:
        app: klustered
        version: v1
    spec:
      volumes:
      - name: certs
        secret:
          secretName: klustered
      containers:
        - name: klustered
          image: klustered
          env:
            - name: IMAGE
              value: docker.io/bitnami/nginx
          ports:
            - containerPort: 8443
              name: https
          volumeMounts:
          - name: certs
            mountPath: "/certs"
            readOnly: true
          resources:
            requests:
              memory: "100Mi"
              cpu: "5m"
            limits:
              memory: "1024Mi"
              cpu: "1000m"
